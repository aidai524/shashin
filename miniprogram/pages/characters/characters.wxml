<!--pages/characters/characters.wxml-->
<view class="page">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">æˆ‘çš„è§’è‰²</text>
    <text class="page-subtitle">{{limits.currentCount}}/{{limits.maxCharacters}}</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- è§’è‰²åˆ—è¡¨ -->
  <scroll-view wx:else class="content-scroll" scroll-y="{{true}}">
    <!-- æœ‰è§’è‰² -->
    <view wx:if="{{characters.length > 0}}" class="character-list">
      <view
        wx:for="{{characters}}"
        wx:key="id"
        class="character-card"
      >
        <!-- ç…§ç‰‡é¢„è§ˆ -->
        <view
          class="photo-preview"
          bindtap="previewPhotos"
          data-photos="{{item.photos}}"
        >
          <view wx:if="{{item.photos && item.photos.length > 0}}" class="photo-grid">
            <image
              wx:for="{{item.photos}}"
              wx:for-item="photo"
              wx:for-index="photoIndex"
              wx:key="id"
              wx:if="{{photoIndex < 4}}"
              class="photo-img"
              src="{{photo.data}}"
              mode="aspectFill"
            />
            <view wx:if="{{item.photos.length > 4}}" class="photo-more">
              +{{item.photos.length - 4}}
            </view>
          </view>
          <view wx:else class="photo-empty">
            <text class="empty-icon">ğŸ“·</text>
            <text class="empty-text">æš‚æ— ç…§ç‰‡</text>
          </view>
        </view>

        <!-- è§’è‰²ä¿¡æ¯ -->
        <view class="character-info">
          <view class="info-left">
            <text class="character-name">{{item.name}}</text>
            <text class="photo-count">{{item.photos.length}}/{{limits.maxPhotosPerCharacter}} å¼ ç…§ç‰‡</text>
          </view>
          <view class="action-buttons">
            <view
              class="action-btn edit-btn"
              bindtap="handleEdit"
              data-id="{{item.id}}"
            >
              <text class="btn-icon">âœï¸</text>
            </view>
            <view
              class="action-btn delete-btn"
              bindtap="handleDelete"
              data-id="{{item.id}}"
              data-index="{{index}}"
            >
              <text class="btn-icon">ğŸ—‘ï¸</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ‘¤</view>
      <text class="empty-title">è¿˜æ²¡æœ‰è§’è‰²</text>
      <text class="empty-desc">åˆ›å»ºè§’è‰²åï¼Œå¯ä»¥ç”¨å®ƒç”Ÿæˆå„ç§é£æ ¼çš„ç…§ç‰‡</text>
    </view>
  </scroll-view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="add-btn-container">
    <button class="add-btn" bindtap="handleAdd">
      <text class="add-icon">+</text>
      <text class="add-text">æ·»åŠ è§’è‰²</text>
    </button>
  </view>
</view>
