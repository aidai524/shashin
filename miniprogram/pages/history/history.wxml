<!--pages/history/history.wxml-->
<view class="page">
  <!-- 加载中 -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 历史记录列表 -->
  <scroll-view wx:else class="content-scroll" scroll-y="{{true}}" enable-back-to-top="{{true}}">
    <!-- 有记录 -->
    <view wx:if="{{records.length > 0}}" class="history-list">
      <view
        wx:for="{{records}}"
        wx:key="id"
        class="history-card"
        bindtap="handleRecordTap"
        data-record="{{item}}"
      >
        <!-- 日期标签 -->
        <view class="date-badge">
          <text>{{item.dateLabel}}</text>
        </view>

        <!-- 图片网格 -->
        <view class="image-grid">
          <view
            wx:for="{{item.thumbUrls}}"
            wx:for-item="thumbUrl"
            wx:for-index="imgIndex"
            wx:key="*index"
            class="image-item"
          >
            <image
              class="history-image"
              src="{{thumbUrl}}"
              mode="aspectFill"
              lazy-load="{{true}}"
            />
          </view>
        </view>

        <!-- 删除按钮 -->
        <view
          class="delete-btn"
          catchtap="handleDelete"
          data-id="{{item.id}}"
          data-index="{{index}}"
        >
          <text class="delete-icon">🗑</text>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view wx:else class="empty-state">
      <view class="empty-icon">📷</view>
      <text class="empty-title">暂无历史记录</text>
      <text class="empty-desc">去首页生成你的第一张照片吧</text>
      <button class="goto-create-btn" bindtap="gotoCreate">开始创作</button>
    </view>
  </scroll-view>

  <!-- 清空按钮 -->
  <view wx:if="{{!loading && records.length > 0}}" class="clear-btn-container">
    <button class="clear-btn" bindtap="handleClearAll">清空历史</button>
  </view>
</view>
