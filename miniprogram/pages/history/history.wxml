<!--pages/history/history.wxml-->
<view class="page">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">History</text>
    <text class="page-subtitle">Your creations</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading-container">
    <view class="spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å†å²è®°å½•åˆ—è¡¨ -->
  <scroll-view wx:else class="content-scroll" scroll-y="{{true}}" enable-back-to-top="{{true}}">
    <!-- æœ‰è®°å½• -->
    <view wx:if="{{records.length > 0}}" class="history-list">
      <view
        wx:for="{{records}}"
        wx:key="id"
        class="history-card"
        bindtap="handleRecordTap"
        data-record="{{item}}"
      >
        <!-- å›¾ç‰‡ç½‘æ ¼ -->
        <view class="image-grid">
          <view
            wx:for="{{item.thumbUrls}}"
            wx:for-item="thumbUrl"
            wx:for-index="imgIndex"
            wx:key="*index"
            class="image-item"
          >
            <image
              class="history-image"
              src="{{thumbUrl}}"
              mode="aspectFill"
              lazy-load="{{true}}"
            />
          </view>
        </view>

        <!-- å¡ç‰‡ä¿¡æ¯ -->
        <view class="card-info">
          <view class="info-left">
            <text class="template-name">{{item.templateName || 'ç”Ÿæˆè®°å½•'}}</text>
            <text class="create-time">{{item.createdAt}}</text>
          </view>
          <view
            class="delete-btn"
            catchtap="handleDelete"
            data-id="{{item.id}}"
            data-index="{{index}}"
          >
            <text class="delete-icon">Ã—</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ“·</view>
      <text class="empty-title">æš‚æ— å†å²è®°å½•</text>
      <text class="empty-desc">å»é¦–é¡µç”Ÿæˆä½ çš„ç¬¬ä¸€å¼ ç…§ç‰‡å§</text>
      <button class="goto-create-btn" bindtap="gotoCreate">å¼€å§‹åˆ›ä½œ</button>
    </view>
  </scroll-view>

  <!-- æ¸…ç©ºæŒ‰é’® -->
  <view wx:if="{{!loading && records.length > 0}}" class="clear-btn-container">
    <button class="clear-btn" bindtap="handleClearAll">æ¸…ç©ºå†å²</button>
  </view>
</view>
