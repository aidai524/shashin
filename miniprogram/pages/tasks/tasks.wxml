<!--pages/tasks/tasks.wxml-->
<view class="page">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <text class="title">ç”Ÿæˆä»»åŠ¡</text>
    <text class="subtitle">æŸ¥çœ‹æ‚¨çš„å›¾ç‰‡ç”Ÿæˆè¿›åº¦</text>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <view class="task-list">
    <view
      wx:for="{{tasks}}"
      wx:key="id"
      class="task-card"
      bindtap="handleTaskTap"
      data-id="{{item.id}}"
      data-record-id="{{item.result.recordId}}"
    >
      <!-- ä»»åŠ¡å¤´éƒ¨ -->
      <view class="task-header">
        <view class="task-status status-{{item.status}}">
          <text class="status-dot"></text>
          <text class="status-text">{{statusText[item.status]}}</text>
        </view>
        <text class="task-time">{{item.createdAt}}</text>
      </view>

      <!-- ä»»åŠ¡ä¿¡æ¯ -->
      <view class="task-info">
        <text class="task-template">{{item.templateName}}</text>
        <view class="task-meta">
          <text class="meta-item">{{qualityText[item.quality]}}</text>
          <text class="meta-item">{{item.ratio}}</text>
          <text class="meta-item">{{item.count}}å¼ </text>
        </view>
      </view>

      <!-- è¿›åº¦æ¡ï¼ˆä»…å¤„ç†ä¸­æ˜¾ç¤ºï¼‰ -->
      <view wx:if="{{item.status === 'processing'}}" class="progress-bar">
        <view class="progress-fill"></view>
      </view>

      <!-- é”™è¯¯ä¿¡æ¯ -->
      <view wx:if="{{item.status === 'failed'}}" class="error-message">
        <text>âš ï¸ {{item.error || 'ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•'}}</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view wx:if="{{tasks.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ“‹</text>
      <text class="empty-text">æš‚æ— ç”Ÿæˆä»»åŠ¡</text>
      <button class="empty-btn" bindtap="gotoCreate">å¼€å§‹åˆ›ä½œ</button>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{loading}}" class="loading-state">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view>
