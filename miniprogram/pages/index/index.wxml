<!--pages/index/index.wxml-->
<view class="page">
  <!-- 页面头部 -->
  <view class="page-header">
    <text class="page-title">Templates</text>
    <text class="page-subtitle">Choose a style</text>
  </view>

  <!-- 分类标签 -->
  <scroll-view class="category-tabs" scroll-x="{{true}}" show-scrollbar="{{false}}">
    <view class="category-list">
      <view
        wx:for="{{categories}}"
        wx:key="id"
        class="category-tab {{currentCat === item.id ? 'active' : ''}} {{pressedCat === item.id ? 'pressed' : ''}}"
        bindtap="handleCategoryTap"
        data-id="{{item.id}}"
      >
        {{item.name}}
      </view>
    </view>
  </scroll-view>

  <!-- 模板网格 -->
  <scroll-view class="content-scroll" scroll-y="{{true}}" bindscrolltolower="loadMore" lower-threshold="100">
    <!-- 加载中 -->
    <view wx:if="{{loading}}" class="skeleton-container">
      <!-- 第一行：三个 9:16 -->
      <view class="skeleton-row">
        <view class="skeleton-item portrait-skeleton"></view>
        <view class="skeleton-item portrait-skeleton"></view>
        <view class="skeleton-item portrait-skeleton"></view>
      </view>
      <!-- 第二行：一个 16:9 -->
      <view class="skeleton-row">
        <view class="skeleton-item landscape-skeleton"></view>
      </view>
      <!-- 第三行：左3:4 右5:3 -->
      <view class="skeleton-row">
        <view class="skeleton-item left-skeleton"></view>
        <view class="skeleton-item right-skeleton"></view>
      </view>
    </view>

    <!-- 模板列表 - 固定三行布局 -->
    <view wx:else class="fixed-layout">
      <!-- 第一行：三个 9:16 竖屏图片 -->
      <view wx:if="{{filteredTemplates.length >= 3}}" class="layout-row row-portraits">
        <view
          wx:for="{{[0,1,2]}}"
          wx:key="*this"
          class="grid-item portrait-item {{pressedCard === filteredTemplates[item].id ? 'pressed' : ''}}"
          bindtap="handleCardTap"
          data-id="{{filteredTemplates[item].id}}"
          bindtouchstart="pressedCardStart"
          bindtouchend="pressedCardEnd"
          bindtouchcancel="pressedCardEnd"
        >
          <image
            class="card-image"
            src="{{filteredTemplates[item].thumbnail}}"
            mode="aspectFill"
          />
          <view wx:if="{{filteredTemplates[item].badge}}" class="card-badge {{filteredTemplates[item].badgeType}}">
            {{filteredTemplates[item].badge}}
          </view>
        </view>
      </view>

      <!-- 第二行：一个 16:9 横屏图片，占满宽度 -->
      <view wx:if="{{filteredTemplates.length >= 4}}" class="layout-row row-landscape">
        <view
          class="grid-item landscape-item {{pressedCard === filteredTemplates[3].id ? 'pressed' : ''}}"
          bindtap="handleCardTap"
          data-id="{{filteredTemplates[3].id}}"
          bindtouchstart="pressedCardStart"
          bindtouchend="pressedCardEnd"
          bindtouchcancel="pressedCardEnd"
        >
          <image
            class="card-image"
            src="{{filteredTemplates[3].thumbnail}}"
            mode="aspectFill"
          />
        </view>
      </view>

      <!-- 第三行：左边 3:4，右边 5:3 -->
      <view wx:if="{{filteredTemplates.length >= 5}}" class="layout-row row-mixed">
        <view
          class="grid-item left-item {{pressedCard === filteredTemplates[4].id ? 'pressed' : ''}}"
          bindtap="handleCardTap"
          data-id="{{filteredTemplates[4].id}}"
          bindtouchstart="pressedCardStart"
          bindtouchend="pressedCardEnd"
          bindtouchcancel="pressedCardEnd"
        >
          <image
            class="card-image"
            src="{{filteredTemplates[4].thumbnail}}"
            mode="aspectFill"
          />
        </view>
        <view
          wx:if="{{filteredTemplates.length >= 6}}"
          class="grid-item right-item {{pressedCard === filteredTemplates[5].id ? 'pressed' : ''}}"
          bindtap="handleCardTap"
          data-id="{{filteredTemplates[5].id}}"
          bindtouchstart="pressedCardStart"
          bindtouchend="pressedCardEnd"
          bindtouchcancel="pressedCardEnd"
        >
          <image
            class="card-image"
            src="{{filteredTemplates[5].thumbnail}}"
            mode="aspectFill"
          />
        </view>
      </view>

      <!-- 更多模板：使用网格布局 -->
      <view wx:if="{{filteredTemplates.length > 6}}" class="more-templates">
        <view
          wx:for="{{filteredTemplates}}"
          wx:key="id"
          wx:if="{{index >= 6}}"
          class="grid-item extra-item {{pressedCard === item.id ? 'pressed' : ''}}"
          bindtap="handleCardTap"
          data-id="{{item.id}}"
          bindtouchstart="pressedCardStart"
          bindtouchend="pressedCardEnd"
          bindtouchcancel="pressedCardEnd"
        >
          <image
            class="card-image"
            src="{{item.thumbnail}}"
            mode="aspectFill"
          />
        </view>
      </view>

      <!-- 空状态 -->
      <view wx:if="{{!loading && filteredTemplates.length === 0}}" class="empty-state">
        <text class="empty-text">暂无模板</text>
      </view>
    </view>
  </scroll-view>
</view>
