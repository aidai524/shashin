<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="theme-color" content="#FAFAFA" />
        <meta name="description" content="Qç‰ˆè¡¨æƒ…åŒ…ç”Ÿæˆå™¨ - ä½¿ç”¨ AI ä¸ºä½ çš„è§’è‰²ç”Ÿæˆå¯çˆ±çš„è¡¨æƒ…åŒ…" />
        <title>Qç‰ˆè¡¨æƒ…åŒ…ç”Ÿæˆå™¨ - Dream Photo Studio</title>
        <!-- åœ¨ CSS åŠ è½½å‰è®¾ç½®ä¸»é¢˜ï¼Œé¿å…é—ªçƒ -->
        <script>
            (function() {
                var theme = localStorage.getItem('gemini_theme') || 'light';
                document.documentElement.setAttribute('data-theme', theme);
                var meta = document.querySelector('meta[name="theme-color"]');
                if (meta) meta.content = theme === 'dark' ? '#0F172A' : '#FAFAFA';
            })();
        </script>
        <link rel="stylesheet" href="style.css?v=20260109" />
        <!-- Phosphor Icons -->
        <script src="https://unpkg.com/@phosphor-icons/web@2.1.1"></script>
        <!-- Cache Manager -->
        <script src="cache.js?v=20260109"></script>
        <!-- JSZip for packaging stickers -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ˜Š</text></svg>" />
        <style>
            /* è¡¨æƒ…åŒ…é¡µé¢ä¸“ç”¨æ ·å¼ */
            .sticker-hero {
                text-align: center;
                padding: 2rem 0;
                margin-bottom: 2rem;
            }
            .sticker-hero h1 {
                font-size: 2.5rem;
                margin-bottom: 0.5rem;
                background: var(--gradient-primary, linear-gradient(to right, #0052FF, #4D7CFF));
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            .sticker-hero p {
                color: var(--text-muted);
                font-size: 1.1rem;
            }
            
            .sticker-steps {
                display: flex;
                justify-content: center;
                gap: 2rem;
                margin-bottom: 3rem;
                flex-wrap: wrap;
            }
            .sticker-step {
                display: flex;
                align-items: center;
                gap: 0.75rem;
                padding: 1rem 1.5rem;
                background: var(--bg-card, #FFFFFF);
                border-radius: 12px;
                border: 1px solid var(--border-default, #E2E8F0);
                box-shadow: var(--shadow-sm, 0 1px 3px rgba(0, 0, 0, 0.06));
                transition: all 0.2s ease;
            }
            .sticker-step .step-text {
                color: var(--text-secondary, #475569);
            }
            .sticker-step.active {
                border-color: var(--accent, #0052FF);
                background: var(--accent-bg, rgba(0, 82, 255, 0.05));
                box-shadow: var(--shadow-accent, 0 4px 14px rgba(0, 82, 255, 0.25));
            }
            .sticker-step.active .step-text {
                color: var(--text-primary, #0F172A);
                font-weight: 600;
            }
            .sticker-step.completed {
                border-color: var(--success, #10B981);
                background: rgba(16, 185, 129, 0.05);
            }
            .sticker-step.completed .step-text {
                color: var(--text-primary, #0F172A);
            }
            .step-num {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                background: var(--bg-muted, #F1F5F9);
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: 600;
                color: var(--text-muted, #64748B);
                transition: all 0.2s ease;
            }
            .sticker-step.active .step-num {
                background: var(--gradient-primary, linear-gradient(to right, #0052FF, #4D7CFF));
                color: white;
            }
            .sticker-step.completed .step-num {
                background: var(--success, #10B981);
                color: white;
            }
            .step-text {
                font-weight: 500;
            }
            
            .sticker-main {
                max-width: 800px;
                margin: 0 auto;
            }
            
            .sticker-section {
                background: var(--bg-card, #FFFFFF);
                border-radius: 16px;
                padding: 2rem;
                margin-bottom: 2rem;
                border: 1px solid var(--border-default, #E2E8F0);
                box-shadow: var(--shadow-sm, 0 1px 3px rgba(0, 0, 0, 0.06));
            }
            .sticker-section h2 {
                font-size: 1.25rem;
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }
            
            .sticker-preview {
                width: 100%;
                max-width: 600px;
                margin: 0 auto;
                aspect-ratio: 1;
                background: var(--bg-muted, #F1F5F9);
                border-radius: 12px;
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
                position: relative;
            }
            .sticker-preview img {
                width: 100%;
                height: 100%;
                object-fit: contain;
            }
            .sticker-preview .placeholder {
                text-align: center;
                color: var(--text-muted);
            }
            .sticker-preview .placeholder i {
                font-size: 4rem;
                margin-bottom: 1rem;
                display: block;
            }
            
            .sticker-grid-overlay {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                pointer-events: none;
                display: none;
            }
            .sticker-grid-overlay.show {
                display: block;
            }
            .sticker-grid-overlay .grid-line-h,
            .sticker-grid-overlay .grid-line-v {
                position: absolute;
                background: rgba(255, 255, 255, 0.3);
            }
            .sticker-grid-overlay .grid-line-h {
                left: 0;
                right: 0;
                height: 1px;
            }
            .sticker-grid-overlay .grid-line-v {
                top: 0;
                bottom: 0;
                width: 1px;
            }
            
            .sticker-actions {
                display: flex;
                justify-content: center;
                gap: 1rem;
                margin-top: 1.5rem;
                flex-wrap: wrap;
            }
            
            .sticker-info {
                background: rgba(0, 229, 192, 0.1);
                border: 1px solid rgba(0, 229, 192, 0.3);
                border-radius: 8px;
                padding: 1rem;
                margin-top: 1rem;
                font-size: 0.9rem;
                color: var(--text-secondary);
            }
            .sticker-info i {
                color: var(--accent-primary);
                margin-right: 0.5rem;
            }
            
            .sticker-result-grid {
                display: grid;
                grid-template-columns: repeat(6, 1fr);
                gap: 8px;
                margin-top: 1rem;
            }
            .sticker-result-item {
                aspect-ratio: 1;
                background: var(--bg-muted, #F1F5F9);
                border-radius: 8px;
                overflow: hidden;
                cursor: pointer;
                transition: transform 0.2s;
            }
            .sticker-result-item:hover {
                transform: scale(1.05);
            }
            .sticker-result-item img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .progress-bar {
                width: 100%;
                height: 8px;
                background: var(--bg-muted, #F1F5F9);
                border-radius: 4px;
                overflow: hidden;
                margin-top: 1rem;
            }
            .progress-bar-fill {
                height: 100%;
                background: var(--gradient-primary, linear-gradient(to right, #0052FF, #4D7CFF));
                border-radius: 4px;
                transition: width 0.3s ease;
            }
            
            .back-link {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                color: var(--text-muted);
                text-decoration: none;
                margin-bottom: 1rem;
                font-size: 0.9rem;
                transition: color 0.2s;
            }
            .back-link:hover {
                color: var(--accent, #0052FF);
            }
            
            /* å†å²è®°å½•åŒºåŸŸ */
            .sticker-history {
                margin-top: 3rem;
                padding-top: 2rem;
                border-top: 1px solid var(--border-default, #E2E8F0);
            }
            .sticker-history h3 {
                font-size: 1.1rem;
                margin-bottom: 1rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: var(--text-primary, #0F172A);
            }
            .history-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1rem;
            }
            .history-item {
                background: var(--bg-card, #FFFFFF);
                border-radius: 12px;
                overflow: hidden;
                border: 1px solid var(--border-default, #E2E8F0);
                transition: transform 0.2s, box-shadow 0.2s;
                cursor: pointer;
            }
            .history-item:hover {
                transform: translateY(-4px);
                box-shadow: var(--shadow-accent, 0 4px 14px rgba(0, 82, 255, 0.25));
                border-color: var(--accent, #0052FF);
            }
            .history-item-thumb {
                aspect-ratio: 1;
                background: var(--bg-muted, #F1F5F9);
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
            }
            .history-item-thumb img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            .history-item-info {
                padding: 0.75rem;
            }
            .history-item-name {
                font-weight: 500;
                font-size: 0.9rem;
                color: var(--text-primary, #0F172A);
                margin-bottom: 0.25rem;
            }
            .history-item-date {
                font-size: 0.75rem;
                color: var(--text-muted, #64748B);
            }
            .history-item-actions {
                display: flex;
                gap: 0.5rem;
                padding: 0 0.75rem 0.75rem;
            }
            .history-item-actions button {
                flex: 1;
                padding: 0.5rem;
                border: none;
                border-radius: 6px;
                font-size: 0.8rem;
                cursor: pointer;
                transition: background 0.2s;
            }
            .history-item-actions .btn-download {
                background: var(--gradient-primary, linear-gradient(to right, #0052FF, #4D7CFF));
                color: white;
            }
            .history-item-actions .btn-download:hover {
                background: var(--gradient-primary-hover, linear-gradient(to right, #0047E0, #3D6AE8));
            }
            .history-item-actions .btn-delete {
                background: var(--bg-muted, #F1F5F9);
                color: var(--text-muted, #64748B);
            }
            .history-item-actions .btn-delete:hover {
                background: rgba(239, 68, 68, 0.1);
                color: var(--error, #EF4444);
            }
            .history-empty {
                text-align: center;
                padding: 2rem;
                color: var(--text-muted);
            }
            .history-empty i {
                font-size: 3rem;
                margin-bottom: 1rem;
                display: block;
                opacity: 0.5;
            }
        </style>
    </head>
    <body>
        <!-- åˆå§‹åŒ–åŠ è½½é®ç½© -->
        <div class="init-loading-overlay" id="initLoadingOverlay">
            <div class="init-loading-content">
                <div class="init-loading-spinner"></div>
                <p class="init-loading-text">åŠ è½½ä¸­...</p>
            </div>
        </div>

        <!-- è£…é¥°èƒŒæ™¯ -->
        <div class="cosmic-bg" aria-hidden="true"></div>
        <div class="grid-overlay" aria-hidden="true"></div>

        <div class="container">
            <header>
                <div class="header-controls">
                    <button class="theme-switch-btn" id="themeSwitchBtn" onclick="toggleTheme()" aria-label="Toggle theme">
                        <i class="ph ph-moon"></i>
                    </button>
                    <!-- ç”¨æˆ·è´¦å· -->
                    <div class="user-menu" id="userMenu">
                        <button class="user-btn" id="loginBtn" onclick="showAuthModal('login')">
                            <i class="ph ph-user"></i>
                            <span>ç™»å½•</span>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-info">
                                <span class="user-avatar" id="userAvatar"><i class="ph ph-user"></i></span>
                                <div class="user-details">
                                    <span class="user-name" id="userName"></span>
                                    <span class="user-plan" id="userPlanBadge"></span>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="showCharactersModal(); return false;" class="dropdown-item">
                                <i class="ph ph-user-circle"></i> æˆ‘çš„è§’è‰²
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="logout(); return false;" class="dropdown-item text-danger">
                                <i class="ph ph-sign-out"></i> é€€å‡ºç™»å½•
                            </a>
                        </div>
                    </div>
                </div>
            </header>

            <main>
                <a href="index.html" class="back-link">
                    <i class="ph ph-arrow-left"></i> è¿”å›ä¸»é¡µ
                </a>
                
                <div class="sticker-hero">
                    <h1><i class="ph ph-smiley-sticker"></i> Qç‰ˆè¡¨æƒ…åŒ…ç”Ÿæˆå™¨</h1>
                    <p>é€‰æ‹©è§’è‰²ï¼Œä¸€é”®ç”Ÿæˆ36ä¸ªå¯çˆ±çš„Qç‰ˆè¡¨æƒ…åŒ…</p>
                </div>

                <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
                <div class="sticker-steps">
                    <div class="sticker-step active" id="step1Indicator">
                        <span class="step-num">1</span>
                        <span class="step-text">é€‰æ‹©è§’è‰²</span>
                    </div>
                    <div class="sticker-step" id="step2Indicator">
                        <span class="step-num">2</span>
                        <span class="step-text">ç”Ÿæˆè¡¨æƒ…åŒ…</span>
                    </div>
                    <div class="sticker-step" id="step3Indicator">
                        <span class="step-num">3</span>
                        <span class="step-text">ä¸‹è½½è¡¨æƒ…åŒ…</span>
                    </div>
                </div>

                <div class="sticker-main">
                    <!-- æ­¥éª¤1: é€‰æ‹©è§’è‰² -->
                    <section class="sticker-section" id="step1Section">
                        <h2><i class="ph ph-user-circle"></i> é€‰æ‹©è§’è‰²</h2>
                        
                        <!-- æœªç™»å½•æç¤º -->
                        <div class="login-required-notice" id="loginRequiredNotice">
                            <div class="notice-icon"><i class="ph ph-lock-key"></i></div>
                            <p>è¯·å…ˆç™»å½•ååˆ›å»ºè§’è‰²</p>
                            <button class="btn btn-primary" onclick="showAuthModal('login')">
                                <span>ç™»å½•</span>
                            </button>
                        </div>
                        
                        <!-- è§’è‰²é€‰æ‹©å™¨ -->
                        <div class="form-group character-select-group" id="characterSelectGroup" style="display: none;">
                            <div class="character-selector" id="characterSelector">
                                <!-- ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            <p class="form-hint">
                                <a href="#" onclick="showCharactersModal(); return false;" style="color: var(--accent-rose);">
                                    <i class="ph ph-user-circle"></i> ç®¡ç†æˆ‘çš„è§’è‰²
                                </a>
                            </p>
                        </div>

                        <!-- æ— è§’è‰²æç¤º -->
                        <div class="no-characters-notice" id="noCharactersNotice" style="display: none;">
                            <div class="notice-icon"><i class="ph ph-user-circle"></i></div>
                            <p>ä½ è¿˜æ²¡æœ‰åˆ›å»ºè§’è‰²</p>
                            <p class="notice-hint">åˆ›å»ºè§’è‰²å¹¶ä¸Šä¼ ç…§ç‰‡åï¼Œå³å¯ç”Ÿæˆè¡¨æƒ…åŒ…</p>
                            <button class="btn btn-primary" onclick="showAddCharacterForm()">
                                <i class="ph ph-plus"></i> æ·»åŠ è§’è‰²
                            </button>
                        </div>

                        <div class="sticker-info">
                            <i class="ph ph-info"></i>
                            <strong>é¢„è®¾å‚æ•°ï¼š</strong>å®½é«˜æ¯” 1:1 | ç”»è´¨ 4Kè¶…æ¸… | ç”Ÿæˆæ•°é‡ 1å¼ 
                        </div>

                        <div class="sticker-actions">
                            <button class="btn btn-primary btn-generate" id="generateBtn" onclick="generateSticker()" disabled>
                                <span class="btn-text"><i class="ph ph-sparkle"></i> ç”Ÿæˆè¡¨æƒ…åŒ…</span>
                                <span class="btn-loading" style="display: none">
                                    <span class="spinner"></span>
                                    åˆ›ä½œä¸­...
                                </span>
                            </button>
                        </div>
                    </section>

                    <!-- æ­¥éª¤2: é¢„è§ˆå¤§å›¾ -->
                    <section class="sticker-section" id="step2Section" style="display: none;">
                        <h2><i class="ph ph-image"></i> è¡¨æƒ…åŒ…é¢„è§ˆ</h2>
                        
                        <div class="sticker-preview" id="stickerPreview">
                            <div class="placeholder">
                                <i class="ph ph-image"></i>
                                <p>è¡¨æƒ…åŒ…å°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
                            </div>
                            <!-- 6x6 ç½‘æ ¼å åŠ å±‚ -->
                            <div class="sticker-grid-overlay" id="gridOverlay"></div>
                        </div>

                        <div class="sticker-info">
                            <i class="ph ph-info"></i>
                            ç”Ÿæˆçš„å›¾ç‰‡åŒ…å« 6Ã—6 å…± 36 ä¸ªè¡¨æƒ…ï¼Œç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¯è‡ªåŠ¨åˆ‡å‰²å¹¶æ‰“åŒ…ä¸‹è½½
                        </div>

                        <div class="sticker-actions">
                            <button class="btn btn-secondary" onclick="regenerateSticker()">
                                <i class="ph ph-arrow-counter-clockwise"></i> é‡æ–°ç”Ÿæˆ
                            </button>
                            <button class="btn btn-primary" id="splitBtn" onclick="splitAndDownload()">
                                <span class="btn-text"><i class="ph ph-scissors"></i> åˆ‡å‰²å¹¶ä¸‹è½½è¡¨æƒ…åŒ…</span>
                                <span class="btn-loading" style="display: none">
                                    <span class="spinner"></span>
                                    å¤„ç†ä¸­...
                                </span>
                            </button>
                        </div>
                    </section>

                    <!-- æ­¥éª¤3: åˆ‡å‰²ç»“æœ -->
                    <section class="sticker-section" id="step3Section" style="display: none;">
                        <h2><i class="ph ph-check-circle"></i> è¡¨æƒ…åŒ…å·²ç”Ÿæˆ</h2>
                        
                        <div class="sticker-result-grid" id="stickerResultGrid">
                            <!-- 36ä¸ªè¡¨æƒ…å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>

                        <div class="progress-bar" id="progressBar" style="display: none;">
                            <div class="progress-bar-fill" id="progressFill" style="width: 0%"></div>
                        </div>

                        <div class="sticker-actions">
                            <button class="btn btn-secondary" onclick="startOver()">
                                <i class="ph ph-arrow-counter-clockwise"></i> é‡æ–°å¼€å§‹
                            </button>
                            <button class="btn btn-primary" id="downloadAllBtn" onclick="downloadAllStickers()">
                                <i class="ph ph-download-simple"></i> ä¸‹è½½å…¨éƒ¨è¡¨æƒ…åŒ… (ZIP)
                            </button>
                        </div>
                    </section>

                    <!-- å†å²è®°å½•åŒºåŸŸ -->
                    <div class="sticker-history" id="stickerHistory">
                        <h3><i class="ph ph-clock-counter-clockwise"></i> å†å²è®°å½•</h3>
                        <div class="history-grid" id="historyGrid">
                            <!-- ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                        <div class="history-empty" id="historyEmpty" style="display: none;">
                            <i class="ph ph-folder-open"></i>
                            <p>æš‚æ— å†å²è®°å½•</p>
                            <p style="font-size: 0.85rem;">ç”Ÿæˆçš„è¡¨æƒ…åŒ…ä¼šè‡ªåŠ¨ä¿å­˜åœ¨è¿™é‡Œ</p>
                        </div>
                    </div>
                </div>
            </main>

            <footer>
                <p>Made with Gemini AI Â· Powered by Cloudflare</p>
            </footer>
        </div>

        <!-- åŠ è½½åŠ¨ç”»é®ç½© -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-pulse-bg" aria-hidden="true"></div>
            <div class="loading-orbits" aria-hidden="true">
                <div class="orbit orbit-1"><span></span><span></span><span></span></div>
                <div class="orbit orbit-2"><span></span><span></span></div>
                <div class="orbit orbit-3"><span></span><span></span><span></span><span></span></div>
            </div>
            <div class="loading-canvas">
                <div class="canvas-frame">
                    <div class="canvas-inner">
                        <div class="canvas-wave"></div>
                        <div class="canvas-wave wave-2"></div>
                        <div class="canvas-wave wave-3"></div>
                    </div>
                    <div class="canvas-corners">
                        <span></span><span></span><span></span><span></span>
                    </div>
                </div>
                <div class="canvas-glow"></div>
            </div>
            <div class="loading-content">
                <p class="loading-text">æ­£åœ¨ç”ŸæˆQç‰ˆè¡¨æƒ…åŒ…...</p>
                <div class="loading-dots">
                    <span></span><span></span><span></span>
                </div>
                <p class="loading-hint">é€šå¸¸éœ€è¦ 30-60 ç§’</p>
            </div>
        </div>

        <!-- å›¾ç‰‡é¢„è§ˆå¼¹çª— -->
        <div class="modal" id="imageModal" onclick="closeModal()" role="dialog" aria-modal="true">
            <div class="modal-content" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeModal()" aria-label="Close"><i class="ph ph-x"></i></span>
                <img id="modalImage" src="" alt="Preview image" />
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="downloadCurrentImage()">
                        <i class="ph ph-download-simple"></i> ä¸‹è½½å›¾ç‰‡
                    </button>
                </div>
            </div>
        </div>

        <!-- ç™»å½•/æ³¨å†Œå¼¹çª— -->
        <div class="modal" id="authModal" onclick="closeAuthModal()" role="dialog" aria-modal="true">
            <div class="modal-content modal-auth" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeAuthModal()" aria-label="Close"><i class="ph ph-x"></i></span>
                
                <!-- ç™»å½•è¡¨å• -->
                <div class="auth-form" id="loginForm">
                    <div class="auth-header">
                        <h2><i class="ph ph-hand-waving"></i> æ¬¢è¿å›æ¥</h2>
                        <p>ç™»å½•ä½ çš„è´¦å·ç»§ç»­åˆ›ä½œ</p>
                    </div>
                    <form onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label for="loginEmail">é‚®ç®±</label>
                            <input type="email" id="loginEmail" required placeholder="your@email.com" />
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">å¯†ç </label>
                            <input type="password" id="loginPassword" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" minlength="6" />
                        </div>
                        <button type="submit" class="btn btn-primary btn-full" id="loginSubmitBtn">
                            <span>ç™»å½•</span>
                        </button>
                    </form>
                    <div class="auth-footer">
                        <p>è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ 
                            <a href="#" onclick="switchAuthForm('register'); return false;">ç«‹å³æ³¨å†Œ</a>
                        </p>
                    </div>
                </div>

                <!-- æ³¨å†Œè¡¨å• -->
                <div class="auth-form" id="registerForm" style="display: none;">
                    <div class="auth-header">
                        <h2><i class="ph ph-confetti"></i> åˆ›å»ºè´¦å·</h2>
                        <p>åŠ å…¥ Dream Photoï¼Œå¼€å¯ AI åˆ›ä½œä¹‹æ—…</p>
                    </div>
                    <form onsubmit="handleRegister(event)">
                        <div class="form-group">
                            <label for="registerEmail">é‚®ç®±</label>
                            <input type="email" id="registerEmail" required placeholder="your@email.com" />
                        </div>
                        <div class="form-group">
                            <label for="registerNickname">æ˜µç§°</label>
                            <input type="text" id="registerNickname" placeholder="ä½ çš„æ˜µç§°" />
                        </div>
                        <div class="form-group">
                            <label for="registerPassword">å¯†ç </label>
                            <input type="password" id="registerPassword" required placeholder="è‡³å°‘6ä½" minlength="6" />
                        </div>
                        <div class="form-group">
                            <label for="registerPasswordConfirm">ç¡®è®¤å¯†ç </label>
                            <input type="password" id="registerPasswordConfirm" required placeholder="å†æ¬¡è¾“å…¥å¯†ç " minlength="6" />
                        </div>
                        <button type="submit" class="btn btn-primary btn-full" id="registerSubmitBtn">
                            <span>æ³¨å†Œ</span>
                        </button>
                    </form>
                    <div class="auth-footer">
                        <p>å·²æœ‰è´¦å·ï¼Ÿ 
                            <a href="#" onclick="switchAuthForm('login'); return false;">ç«‹å³ç™»å½•</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- è§’è‰²ç®¡ç†å¼¹çª— -->
        <div class="modal" id="charactersModal" onclick="closeCharactersModal()" role="dialog" aria-modal="true">
            <div class="modal-content modal-characters" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeCharactersModal()" aria-label="Close"><i class="ph ph-x"></i></span>
                <div class="characters-content">
                    <div class="characters-header">
                        <h2><i class="ph ph-user-circle"></i> æˆ‘çš„è§’è‰²</h2>
                        <p class="characters-limit" id="charactersLimit"></p>
                    </div>
                    
                    <div class="characters-grid" id="charactersGrid">
                        <!-- ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                    
                    <button class="btn btn-primary btn-add-character" id="addCharacterBtn" onclick="showAddCharacterForm()">
                        <i class="ph ph-plus"></i> æ·»åŠ è§’è‰²
                    </button>
                </div>
            </div>
        </div>

        <!-- ç¼–è¾‘è§’è‰²å¼¹çª— -->
        <div class="modal" id="editCharacterModal" onclick="closeEditCharacterModal()" role="dialog" aria-modal="true">
            <div class="modal-content modal-edit-character" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeEditCharacterModal()" aria-label="Close"><i class="ph ph-x"></i></span>
                <div class="edit-character-content">
                    <h2 id="editCharacterTitle"><i class="ph ph-pencil-simple"></i> ç¼–è¾‘è§’è‰²</h2>
                    
                    <form id="characterForm" onsubmit="handleSaveCharacter(event)">
                        <input type="hidden" id="characterId" />
                        <div class="form-group">
                            <label for="characterName">è§’è‰²åç§°</label>
                            <input type="hidden" id="characterName" required />
                            <div class="fancy-select" id="characterSelect">
                                <div class="fancy-select-trigger" onclick="toggleFancySelect()">
                                    <span class="fancy-select-value placeholder">è¯·é€‰æ‹©è§’è‰²</span>
                                    <i class="ph ph-caret-down fancy-select-arrow"></i>
                                </div>
                                <div class="fancy-select-dropdown">
                                    <div class="fancy-select-group">
                                        <div class="fancy-select-group-label"><i class="ph ph-user"></i> å¸¸ç”¨</div>
                                        <div class="fancy-select-option" data-value="æœ¬äºº">æœ¬äºº</div>
                                        <div class="fancy-select-option" data-value="è€å©†">è€å©†</div>
                                        <div class="fancy-select-option" data-value="è€å…¬">è€å…¬</div>
                                        <div class="fancy-select-option" data-value="å¥³å„¿">å¥³å„¿</div>
                                        <div class="fancy-select-option" data-value="å„¿å­">å„¿å­</div>
                                    </div>
                                    <div class="fancy-select-group">
                                        <div class="fancy-select-group-label"><i class="ph ph-users-three"></i> çˆ¶æ¯</div>
                                        <div class="fancy-select-option" data-value="çˆ¸çˆ¸">çˆ¸çˆ¸</div>
                                        <div class="fancy-select-option" data-value="å¦ˆå¦ˆ">å¦ˆå¦ˆ</div>
                                        <div class="fancy-select-option" data-value="å…¬å…¬">å…¬å…¬</div>
                                        <div class="fancy-select-option" data-value="å©†å©†">å©†å©†</div>
                                    </div>
                                    <div class="fancy-select-group">
                                        <div class="fancy-select-group-label"><i class="ph ph-users"></i> ç¥–è¾ˆ</div>
                                        <div class="fancy-select-option" data-value="çˆ·çˆ·">çˆ·çˆ·</div>
                                        <div class="fancy-select-option" data-value="å¥¶å¥¶">å¥¶å¥¶</div>
                                        <div class="fancy-select-option" data-value="å¤–å…¬">å¤–å…¬</div>
                                        <div class="fancy-select-option" data-value="å¤–å©†">å¤–å©†</div>
                                    </div>
                                    <div class="fancy-select-group">
                                        <div class="fancy-select-group-label"><i class="ph ph-plus-circle"></i> æ›´å¤š</div>
                                        <div class="fancy-select-option" data-value="å…¶ä»–">å…¶ä»–</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="characterDesc">æè¿°ï¼ˆå¯é€‰ï¼‰</label>
                            <input type="text" id="characterDesc" placeholder="ç®€å•æè¿°è¿™ä¸ªè§’è‰²" />
                        </div>
                        
                        <!-- ç…§ç‰‡ç®¡ç† -->
                        <div class="character-photos-section" id="characterPhotosSection" style="display: none;">
                            <label>å‚è€ƒç…§ç‰‡</label>
                            <p class="form-hint">ä¸Šä¼ ä¸åŒè§’åº¦çš„æ¸…æ™°ç…§ç‰‡ï¼Œå¸®åŠ© AI æ›´å¥½åœ°é”å®šé¢éƒ¨ç‰¹å¾</p>
                            
                            <div class="character-photos-grid" id="characterPhotosGrid">
                                <!-- ç”± JS åŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            
                            <div class="photo-upload-area" id="photoUploadArea">
                                <input type="file" id="photoUploadInput" accept="image/*" onchange="handlePhotoUpload(event)" class="file-input-hidden" />
                                <label for="photoUploadInput" class="photo-upload-btn">
                                    <i class="ph ph-camera"></i>
                                    <span>ä¸Šä¼ ç…§ç‰‡</span>
                                </label>
                                <span class="photo-limit-text" id="photoLimitText"></span>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeEditCharacterModal()">
                                <span>å–æ¶ˆ</span>
                            </button>
                            <button type="submit" class="btn btn-primary" id="saveCharacterBtn">
                                <span>ä¿å­˜</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Toast é€šçŸ¥ -->
        <div class="toast-container" id="toastContainer"></div>

        <script src="sticker.js?v=20260109"></script>
    </body>
</html>
