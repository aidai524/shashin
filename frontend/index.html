<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="theme-color" content="#FAFAFA" />
        <meta name="description" content="使用 Google Gemini AI 生成精美图片 - Dream Photo Studio" />
        <title>Dream Photo Studio - AI 图片生成器</title>
        <!-- 在 CSS 加载前设置主题，避免闪烁 -->
        <script>
            (function() {
                var theme = localStorage.getItem('gemini_theme') || 'light';
                document.documentElement.setAttribute('data-theme', theme);
                var meta = document.querySelector('meta[name="theme-color"]');
                if (meta) meta.content = theme === 'dark' ? '#0F172A' : '#FAFAFA';
            })();
        </script>
        <link rel="stylesheet" href="style.css?v=20260107v" />
        <!-- Phosphor Icons -->
        <script src="https://unpkg.com/@phosphor-icons/web@2.1.1"></script>
        <!-- Cache Manager -->
        <script src="cache.js?v=20260109"></script>
        <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✨</text></svg>" />
    </head>
    <body>
        <!-- 初始化加载遮罩 - 默认显示，数据加载完成后隐藏 -->
        <div class="init-loading-overlay" id="initLoadingOverlay">
            <div class="init-loading-content">
                <div class="init-loading-spinner"></div>
                <p class="init-loading-text">加载中...</p>
            </div>
        </div>

        <!-- 装饰背景 -->
        <div class="cosmic-bg" aria-hidden="true"></div>
        <div class="grid-overlay" aria-hidden="true"></div>

        <div class="container">
            <header>
                <div class="header-controls">
                    <button class="theme-switch-btn" id="themeSwitchBtn" onclick="toggleTheme()" aria-label="Toggle theme">
                        <i class="ph ph-moon"></i>
                    </button>
                    <!-- 用户账号 -->
                    <div class="user-menu" id="userMenu">
                        <button class="user-btn" id="loginBtn" onclick="showAuthModal('login')">
                            <i class="ph ph-user"></i>
                            <span data-i18n="auth.login">登录</span>
                        </button>
                        <div class="user-dropdown" id="userDropdown">
                            <div class="user-info">
                                <span class="user-avatar" id="userAvatar"><i class="ph ph-user"></i></span>
                                <div class="user-details">
                                    <span class="user-name" id="userName"></span>
                                    <span class="user-plan" id="userPlanBadge"></span>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a href="/wallet" class="dropdown-item">
                                <i class="ph ph-wallet"></i> <span data-i18n="user.wallet">我的钱包</span>
                                <span class="points-badge" id="userPointsBalance" style="margin-left:auto;background:var(--accent-bg);color:var(--accent);padding:2px 8px;border-radius:10px;font-size:0.8rem;font-weight:600;"></span>
                            </a>
                            <a href="/invite" class="dropdown-item">
                                <i class="ph ph-users-three"></i> <span data-i18n="user.invite">邀请好友</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="showCharactersModal(); return false;" class="dropdown-item">
                                <i class="ph ph-user-circle"></i> <span data-i18n="user.characters">我的角色</span>
                            </a>
                            <a href="#" onclick="showSettingsModal(); return false;" class="dropdown-item">
                                <i class="ph ph-gear"></i> <span data-i18n="user.settings">账号设置</span>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="logout(); return false;" class="dropdown-item text-danger">
                                <i class="ph ph-sign-out"></i> <span data-i18n="auth.logout">退出登录</span>
                            </a>
                        </div>
                    </div>
                </div>
                <h1><i class="ph ph-sparkle"></i> <span data-i18n="site.title">Dream Photo</span></h1>
                <p class="subtitle" data-i18n="site.subtitle">Powered by Gemini AI · Create Your Perfect Portrait</p>
            </header>

            <main>
                <!-- 步骤 1: 选择模板 -->
                <section class="template-section">
                    <div class="section-header">
                        <h2><span class="step-number">1</span> <span data-i18n="template.title">选择风格模板</span></h2>
                        <p class="section-desc" data-i18n="template.desc">点击选择你喜欢的风格，AI 将按此风格生成图片</p>
                    </div>
                    
                    <!-- 模板分类标签 -->
                    <div class="template-categories" id="templateCategories">
                        <button type="button" class="category-btn active" data-category="all" data-i18n="template.category.all">全部</button>
                        <button type="button" class="category-btn" data-category="portrait" data-i18n="template.category.portrait">人像写真</button>
                        <button type="button" class="category-btn" data-category="creative" data-i18n="template.category.creative">创意艺术</button>
                        <button type="button" class="category-btn" data-category="scene" data-i18n="template.category.scene">场景合成</button>
                    </div>
                    
                    <!-- 模板网格 -->
                    <div class="template-grid" id="templateGrid">
                        <!-- 模板卡片由 JS 动态生成 -->
                    </div>
                    
                    <!-- 已选模板详情 -->
                    <div class="selected-template" id="selectedTemplate" style="display: none;">
                        <div class="selected-template-preview">
                            <img id="selectedTemplateImg" src="" alt="Selected template" />
                        </div>
                        <div class="selected-template-info">
                            <h3 id="selectedTemplateName"></h3>
                            <p id="selectedTemplateDesc"></p>
                            <button type="button" class="btn btn-small btn-secondary" onclick="clearTemplateSelection()">
                                <i class="ph ph-x"></i> <span data-i18n="template.change">更换模板</span>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- 步骤 2: 选择角色 -->
                <section class="generate-section">
                    <div class="section-header">
                        <h2><span class="step-number">2</span> <span data-i18n="characters.select.title">选择角色</span></h2>
                        <p class="section-desc" data-i18n="characters.select.desc">选择一个已创建的角色，AI 将使用其照片进行锁脸生成</p>
                    </div>

                    <!-- 未登录提示 -->
                    <div class="login-required-notice" id="loginRequiredNotice">
                        <div class="notice-icon"><i class="ph ph-lock-key"></i></div>
                        <p data-i18n="characters.login.required">请先登录后创建角色</p>
                        <button class="btn btn-primary" onclick="showAuthModal('login')">
                            <span data-i18n="auth.login">登录</span>
                        </button>
                        </div>
                    
                    <!-- 角色选择器（已登录用户可见） -->
                    <div class="form-group character-select-group" id="characterSelectGroup" style="display: none;">
                        <div class="character-selector" id="characterSelector">
                            <!-- 由 JS 动态生成 -->
                        </div>
                        <p class="form-hint">
                            <a href="#" onclick="showCharactersModal(); return false;" style="color: var(--accent-rose);">
                                <i class="ph ph-user-circle"></i> <span data-i18n="user.characters">管理我的角色</span>
                            </a>
                        </p>
                    </div>

                    <!-- 无角色提示 -->
                    <div class="no-characters-notice" id="noCharactersNotice" style="display: none;">
                        <div class="notice-icon"><i class="ph ph-user-circle"></i></div>
                        <p data-i18n="characters.empty.notice">你还没有创建角色</p>
                        <p class="notice-hint" data-i18n="characters.empty.notice.hint">创建角色并上传照片后，即可使用锁脸功能生成图片</p>
                        <button class="btn btn-primary" onclick="showAddCharacterForm()">
                            <i class="ph ph-plus"></i> <span data-i18n="characters.add">添加角色</span>
                        </button>
                    </div>
                </section>

                <!-- 步骤 3: 调整参数 - 折叠式设计 -->
                <section class="settings-section">
                    <div class="section-header">
                        <h2><span class="step-number">3</span> <span data-i18n="settings.title">调整设置</span></h2>
                        <p class="section-desc" data-i18n="settings.desc">点击选项可展开调整，默认为推荐配置</p>
                    </div>

                    <!-- 折叠式参数设置 -->
                    <div class="settings-compact">
                        <!-- 宽高比 -->
                        <div class="setting-item" data-setting="aspectRatio">
                            <div class="setting-header" onclick="toggleSetting('aspectRatio')">
                                <div class="setting-info">
                                    <i class="ph ph-rectangle"></i>
                                    <span class="setting-label" data-i18n="aspectratio.label">宽高比</span>
                                </div>
                                <div class="setting-value">
                                    <div class="setting-preview" id="aspectRatioPreview">
                                        <div class="aspect-icon-mini" style="width: 16px; height: 16px;"></div>
                                        <span>1:1</span>
                                    </div>
                                    <i class="ph ph-caret-down setting-arrow"></i>
                                </div>
                            </div>
                            <div class="setting-options" id="aspectRatioOptions">
                                <div class="aspect-ratio-grid" id="aspectRatioGrid">
                                    <button type="button" class="aspect-btn active" data-ratio="1:1" title="1:1 正方形">
                                        <div class="aspect-icon" style="width: 28px; height: 28px;"></div>
                                        <span>1:1</span>
                                    </button>
                                    <button type="button" class="aspect-btn" data-ratio="16:9" title="16:9 横屏">
                                        <div class="aspect-icon" style="width: 36px; height: 20px;"></div>
                                        <span>16:9</span>
                                    </button>
                                    <button type="button" class="aspect-btn" data-ratio="9:16" title="9:16 竖屏">
                                        <div class="aspect-icon" style="width: 20px; height: 36px;"></div>
                                        <span>9:16</span>
                                    </button>
                                    <button type="button" class="aspect-btn" data-ratio="4:3" title="4:3 标准">
                                        <div class="aspect-icon" style="width: 32px; height: 24px;"></div>
                                        <span>4:3</span>
                                    </button>
                                    <button type="button" class="aspect-btn" data-ratio="3:4" title="3:4 竖屏">
                                        <div class="aspect-icon" style="width: 24px; height: 32px;"></div>
                                        <span>3:4</span>
                                    </button>
                                    <button type="button" class="aspect-btn" data-ratio="3:2" title="3:2 照片">
                                        <div class="aspect-icon" style="width: 33px; height: 22px;"></div>
                                        <span>3:2</span>
                                    </button>
                                    <button type="button" class="aspect-btn" data-ratio="2:3" title="2:3 竖版">
                                        <div class="aspect-icon" style="width: 22px; height: 33px;"></div>
                                        <span>2:3</span>
                                    </button>
                                    <button type="button" class="aspect-btn" data-ratio="21:9" title="21:9 超宽">
                                        <div class="aspect-icon" style="width: 42px; height: 18px;"></div>
                                        <span>21:9</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 生成质量 -->
                        <div class="setting-item" data-setting="model">
                            <div class="setting-header" onclick="toggleSetting('model')">
                                <div class="setting-info">
                                    <i class="ph ph-star"></i>
                                    <span class="setting-label" data-i18n="model.label">生成质量</span>
                                </div>
                                <div class="setting-value">
                                    <div class="setting-preview" id="modelPreview">
                                        <i class="ph-fill ph-star"></i>
                                        <span data-i18n="model.premium">高级</span>
                                    </div>
                                    <i class="ph ph-caret-down setting-arrow"></i>
                                </div>
                            </div>
                            <div class="setting-options" id="modelOptions">
                                <div class="model-toggle" id="modelToggle">
                                    <button type="button" class="model-btn active" data-model="gemini-3-pro-image-preview">
                                        <span class="model-icon"><i class="ph-fill ph-star"></i></span>
                                        <span class="model-name" data-i18n="model.premium">高级</span>
                                        <span class="model-desc" data-i18n="model.premium.desc">4K 高清</span>
                                    </button>
                                    <button type="button" class="model-btn" data-model="gemini-2.5-flash-image">
                                        <span class="model-icon"><i class="ph-fill ph-lightning"></i></span>
                                        <span class="model-name" data-i18n="model.fast">快速</span>
                                        <span class="model-desc" data-i18n="model.fast.desc">标准画质</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- 生成数量 -->
                        <div class="setting-item" data-setting="quantity">
                            <div class="setting-header" onclick="toggleSetting('quantity')">
                                <div class="setting-info">
                                    <i class="ph ph-images"></i>
                                    <span class="setting-label" data-i18n="quantity.label">生成数量</span>
                                </div>
                                <div class="setting-value">
                                    <div class="setting-preview" id="quantityPreview">
                                        <span class="qty-badge">1</span>
                                        <span>张 · ~30秒</span>
                                    </div>
                                    <i class="ph ph-caret-down setting-arrow"></i>
                                </div>
                            </div>
                            <div class="setting-options" id="quantityOptions">
                                <div class="quantity-selector" id="quantitySelector">
                                    <button type="button" class="quantity-btn active" data-count="1">
                                        <span class="quantity-num">1</span>
                                        <span class="quantity-time">~30秒</span>
                                    </button>
                                    <button type="button" class="quantity-btn" data-count="2">
                                        <span class="quantity-num">2</span>
                                        <span class="quantity-time">~60秒</span>
                                    </button>
                                    <button type="button" class="quantity-btn" data-count="4">
                                        <span class="quantity-num">4</span>
                                        <span class="quantity-time">~2分钟</span>
                                    </button>
                        </div>
                    </div>
                        </div>

                        <!-- 画质/分辨率 -->
                        <div class="setting-item" data-setting="resolution" id="resolutionGroup">
                            <div class="setting-header" onclick="toggleSetting('resolution')">
                                <div class="setting-info">
                                    <i class="ph ph-high-definition"></i>
                                    <span class="setting-label" data-i18n="resolution.label">画质</span>
                                </div>
                                <div class="setting-value">
                                    <div class="setting-preview" id="resolutionPreview">
                                        <span class="res-badge">4K</span>
                                        <span>超清</span>
                                    </div>
                                    <i class="ph ph-caret-down setting-arrow"></i>
                                </div>
                            </div>
                            <div class="setting-options" id="resolutionOptions">
                                <div class="resolution-selector" id="resolutionSelector">
                                    <button type="button" class="resolution-btn" data-size="1K">
                                        <span class="resolution-label">标准</span>
                                        <span class="resolution-size">1K</span>
                                    </button>
                                    <button type="button" class="resolution-btn" data-size="2K">
                                        <span class="resolution-label">高清</span>
                                        <span class="resolution-size">2K</span>
                                    </button>
                                    <button type="button" class="resolution-btn active" data-size="4K">
                                        <span class="resolution-label">超清</span>
                                        <span class="resolution-size">4K</span>
                                    </button>
                                </div>
                                <p class="form-hint resolution-hint" id="resolutionHint" data-i18n="resolution.hint.supported">
                                    高级模式支持 1K/2K/4K 分辨率
                                </p>
                            </div>
                        </div>
                    </div>

                    <button
                        class="btn btn-primary btn-generate"
                        id="generateBtn"
                        onclick="generateImage()"
                    >
                        <span class="btn-text"><i class="ph ph-sparkle"></i> <span data-i18n="generate.button">生成图片</span></span>
                        <span class="btn-loading" style="display: none">
                            <span class="spinner"></span>
                            <span data-i18n="generate.loading">创作中...</span>
                        </span>
                    </button>
                </section>

                <!-- 当前生成结果 -->
                <section
                    class="result-section"
                    id="resultSection"
                    style="display: none"
                >
                    <h2><i class="ph ph-palette"></i> <span data-i18n="result.title">生成结果</span></h2>
                    <div class="result-images" id="resultImages"></div>
                </section>

                <!-- 历史记录 -->
                <section class="history-section">
                    <div class="history-header">
                        <h2><i class="ph ph-clock-counter-clockwise"></i> <span data-i18n="history.title">历史记录</span></h2>
                        <button class="btn btn-danger btn-small" onclick="clearHistory()">
                            <i class="ph ph-trash"></i> <span data-i18n="history.clear">清空</span>
                        </button>
                    </div>
                    <div class="history-grid" id="historyGrid">
                        <p class="empty-tip"><i class="ph ph-image-broken"></i> <span data-i18n="history.empty">暂无历史记录，开始创作吧！</span></p>
                    </div>
                </section>
            </main>

            <footer>
                <p data-i18n="footer.text">Made with Gemini AI · Powered by Cloudflare</p>
            </footer>
        </div>

        <!-- 加载动画遮罩 -->
        <div class="loading-overlay" id="loadingOverlay">
            <!-- 背景脉冲光晕 -->
            <div class="loading-pulse-bg" aria-hidden="true"></div>
            
            <!-- 轨道粒子系统 -->
            <div class="loading-orbits" aria-hidden="true">
                <div class="orbit orbit-1"><span></span><span></span><span></span></div>
                <div class="orbit orbit-2"><span></span><span></span></div>
                <div class="orbit orbit-3"><span></span><span></span><span></span><span></span></div>
            </div>
            
            <!-- 中心画框动画 -->
            <div class="loading-canvas">
                <div class="canvas-frame">
                    <div class="canvas-inner">
                        <div class="canvas-wave"></div>
                        <div class="canvas-wave wave-2"></div>
                        <div class="canvas-wave wave-3"></div>
                    </div>
                    <div class="canvas-corners">
                        <span></span><span></span><span></span><span></span>
                    </div>
                </div>
                <div class="canvas-glow"></div>
            </div>
            
            <!-- 文字内容 -->
            <div class="loading-content">
                <p class="loading-text" data-i18n="loading.title">正在创作你的杰作...</p>
                <div class="loading-dots">
                    <span></span><span></span><span></span>
                </div>
                <p class="loading-hint" data-i18n="loading.hint">通常需要 10-30 秒</p>
            </div>
        </div>

        <!-- 图片预览弹窗 -->
        <div class="modal" id="imageModal" onclick="closeModal()" role="dialog" aria-modal="true">
            <div class="modal-content" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeModal()" aria-label="Close"><i class="ph ph-x"></i></span>
                <img id="modalImage" src="" alt="Preview image" />
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="downloadImage()">
                        <i class="ph ph-download-simple"></i> <span data-i18n="modal.download">下载图片</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 历史详情弹窗 -->
        <div class="modal" id="historyModal" onclick="closeHistoryModal()" role="dialog" aria-modal="true">
            <div class="modal-content modal-large" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeHistoryModal()" aria-label="Close"><i class="ph ph-x"></i></span>
                <div class="history-detail" id="historyDetail"></div>
            </div>
        </div>

        <!-- 登录/注册弹窗 -->
        <div class="modal" id="authModal" onclick="closeAuthModal()" role="dialog" aria-modal="true">
            <div class="modal-content modal-auth" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeAuthModal()" aria-label="Close"><i class="ph ph-x"></i></span>
                
                <!-- 登录表单 -->
                <div class="auth-form" id="loginForm">
                    <div class="auth-header">
                        <h2><i class="ph ph-hand-waving"></i> <span data-i18n="auth.login.title">欢迎回来</span></h2>
                        <p data-i18n="auth.login.subtitle">登录你的账号继续创作</p>
                    </div>
                    <form onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label for="loginEmail" data-i18n="auth.email">邮箱</label>
                            <input type="email" id="loginEmail" required placeholder="your@email.com" />
                        </div>
                        <div class="form-group">
                            <label for="loginPassword" data-i18n="auth.password">密码</label>
                            <input type="password" id="loginPassword" required placeholder="••••••••" minlength="6" />
                        </div>
                        <button type="submit" class="btn btn-primary btn-full" id="loginSubmitBtn">
                            <span data-i18n="auth.login.submit">登录</span>
                        </button>
                    </form>
                    <div class="auth-footer">
                        <p><span data-i18n="auth.no.account">还没有账号？</span> 
                            <a href="#" onclick="switchAuthForm('register'); return false;" data-i18n="auth.register.now">立即注册</a>
                        </p>
                    </div>
                </div>

                <!-- 注册表单 -->
                <div class="auth-form" id="registerForm" style="display: none;">
                    <div class="auth-header">
                        <h2><i class="ph ph-confetti"></i> <span data-i18n="auth.register.title">创建账号</span></h2>
                        <p data-i18n="auth.register.subtitle">加入梦想写真馆，开启 AI 创作之旅</p>
                    </div>
                    <form onsubmit="handleRegister(event)">
                        <div class="form-group">
                            <label for="registerEmail" data-i18n="auth.email">邮箱</label>
                            <input type="email" id="registerEmail" required placeholder="your@email.com" />
                        </div>
                        <div class="form-group">
                            <label for="registerNickname" data-i18n="auth.nickname">昵称</label>
                            <input type="text" id="registerNickname" placeholder="你的昵称" />
                        </div>
                        <div class="form-group">
                            <label for="registerPassword" data-i18n="auth.password">密码</label>
                            <input type="password" id="registerPassword" required placeholder="至少6位" minlength="6" />
                        </div>
                        <div class="form-group">
                            <label for="registerPasswordConfirm" data-i18n="auth.password.confirm">确认密码</label>
                            <input type="password" id="registerPasswordConfirm" required placeholder="再次输入密码" minlength="6" />
                        </div>
                        <button type="submit" class="btn btn-primary btn-full" id="registerSubmitBtn">
                            <span data-i18n="auth.register.submit">注册</span>
                        </button>
                    </form>
                    <div class="auth-footer">
                        <p><span data-i18n="auth.have.account">已有账号？</span> 
                            <a href="#" onclick="switchAuthForm('login'); return false;" data-i18n="auth.login.now">立即登录</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 账号设置弹窗 -->
        <div class="modal" id="settingsModal" onclick="closeSettingsModal()" role="dialog" aria-modal="true">
            <div class="modal-content modal-settings" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeSettingsModal()" aria-label="Close"><i class="ph ph-x"></i></span>
                <div class="settings-content">
                    <h2><i class="ph ph-gear"></i> <span data-i18n="settings.account.title">账号设置</span></h2>
                    
                    <div class="settings-section">
                        <h3 data-i18n="settings.profile">个人信息</h3>
                        <form id="profileForm" onsubmit="handleUpdateProfile(event)">
                            <div class="form-group">
                                <label for="settingsNickname" data-i18n="auth.nickname">昵称</label>
                                <input type="text" id="settingsNickname" />
                            </div>
                            <button type="submit" class="btn btn-primary btn-small">
                                <span data-i18n="settings.save">保存</span>
                            </button>
                        </form>
                    </div>

                    <div class="settings-section">
                        <h3 data-i18n="settings.plan">当前套餐</h3>
                        <div class="plan-info" id="settingsPlanInfo">
                            <div class="plan-badge" id="settingsPlanBadge">免费版</div>
                            <p class="plan-limits" id="settingsPlanLimits"></p>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 data-i18n="settings.password">修改密码</h3>
                        <form id="passwordForm" onsubmit="handleChangePassword(event)">
                            <div class="form-group">
                                <label for="oldPassword" data-i18n="settings.old.password">旧密码</label>
                                <input type="password" id="oldPassword" required minlength="6" />
                            </div>
                            <div class="form-group">
                                <label for="newPassword" data-i18n="settings.new.password">新密码</label>
                                <input type="password" id="newPassword" required minlength="6" />
                            </div>
                            <button type="submit" class="btn btn-secondary btn-small">
                                <span data-i18n="settings.change.password">修改密码</span>
                            </button>
                        </form>
                    </div>

                    <div class="settings-section settings-logout">
                        <button type="button" class="btn btn-danger" onclick="logout(); closeSettingsModal();">
                            <i class="ph ph-sign-out"></i> <span data-i18n="auth.logout">退出登录</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 角色管理弹窗 -->
        <div class="modal" id="charactersModal" onclick="closeCharactersModal()" role="dialog" aria-modal="true">
            <div class="modal-content modal-characters" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeCharactersModal()" aria-label="Close"><i class="ph ph-x"></i></span>
                <div class="characters-content">
                    <div class="characters-header">
                        <h2><i class="ph ph-user-circle"></i> <span data-i18n="characters.title">我的角色</span></h2>
                        <p class="characters-limit" id="charactersLimit"></p>
                    </div>
                    
                    <!-- 角色列表 -->
                    <div class="characters-grid" id="charactersGrid">
                        <!-- 由 JS 动态生成 -->
                    </div>
                    
                    <!-- 添加角色按钮 -->
                    <button class="btn btn-primary btn-add-character" id="addCharacterBtn" onclick="showAddCharacterForm()">
                        <i class="ph ph-plus"></i> <span data-i18n="characters.add">添加角色</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 编辑角色弹窗 -->
        <div class="modal" id="editCharacterModal" onclick="closeEditCharacterModal()" role="dialog" aria-modal="true">
            <div class="modal-content modal-edit-character" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeEditCharacterModal()" aria-label="Close"><i class="ph ph-x"></i></span>
                <div class="edit-character-content">
                    <h2 id="editCharacterTitle"><i class="ph ph-pencil-simple"></i> <span data-i18n="characters.edit">编辑角色</span></h2>
                    
                    <form id="characterForm" onsubmit="handleSaveCharacter(event)">
                        <input type="hidden" id="characterId" />
                        <div class="form-group">
                            <label for="characterName" data-i18n="characters.name">角色名称</label>
                            <input type="hidden" id="characterName" required />
                            <div class="fancy-select" id="characterSelect">
                                <div class="fancy-select-trigger" onclick="toggleFancySelect()">
                                    <span class="fancy-select-value"></span>
                                    <i class="ph ph-caret-down fancy-select-arrow"></i>
                                </div>
                                <div class="fancy-select-dropdown">
                                    <div class="fancy-select-group">
                                        <div class="fancy-select-group-label"><i class="ph ph-user"></i> 常用</div>
                                        <div class="fancy-select-option" data-value="本人">本人</div>
                                        <div class="fancy-select-option" data-value="老婆">老婆</div>
                                        <div class="fancy-select-option" data-value="老公">老公</div>
                                        <div class="fancy-select-option" data-value="女儿">女儿</div>
                                        <div class="fancy-select-option" data-value="儿子">儿子</div>
                                    </div>
                                    <div class="fancy-select-group">
                                        <div class="fancy-select-group-label"><i class="ph ph-users-three"></i> 父母</div>
                                        <div class="fancy-select-option" data-value="爸爸">爸爸</div>
                                        <div class="fancy-select-option" data-value="妈妈">妈妈</div>
                                        <div class="fancy-select-option" data-value="公公">公公</div>
                                        <div class="fancy-select-option" data-value="婆婆">婆婆</div>
                                    </div>
                                    <div class="fancy-select-group">
                                        <div class="fancy-select-group-label"><i class="ph ph-users"></i> 祖辈</div>
                                        <div class="fancy-select-option" data-value="爷爷">爷爷</div>
                                        <div class="fancy-select-option" data-value="奶奶">奶奶</div>
                                        <div class="fancy-select-option" data-value="外公">外公</div>
                                        <div class="fancy-select-option" data-value="外婆">外婆</div>
                                    </div>
                                    <div class="fancy-select-group">
                                        <div class="fancy-select-group-label"><i class="ph ph-plus-circle"></i> 更多</div>
                                        <div class="fancy-select-option" data-value="其他">其他</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="characterDesc" data-i18n="characters.description">描述（可选）</label>
                            <input type="text" id="characterDesc" placeholder="简单描述这个角色" />
                        </div>
                        
                        <!-- 照片管理 -->
                        <div class="character-photos-section" id="characterPhotosSection" style="display: none;">
                            <label data-i18n="characters.photos">参考照片</label>
                            <p class="form-hint" data-i18n="characters.photos.hint">上传不同角度的清晰照片，帮助 AI 更好地锁定面部特征</p>
                            
                            <div class="character-photos-grid" id="characterPhotosGrid">
                                <!-- 由 JS 动态生成 -->
                            </div>
                            
                            <div class="photo-upload-area" id="photoUploadArea">
                                <input type="file" id="photoUploadInput" accept="image/*" onchange="handlePhotoUpload(event)" class="file-input-hidden" />
                                <label for="photoUploadInput" class="photo-upload-btn">
                                    <i class="ph ph-camera"></i>
                                    <span data-i18n="characters.upload.photo">上传照片</span>
                                </label>
                                <span class="photo-limit-text" id="photoLimitText"></span>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" onclick="closeEditCharacterModal()">
                                <span data-i18n="common.cancel">取消</span>
                            </button>
                            <button type="submit" class="btn btn-primary" id="saveCharacterBtn">
                                <span data-i18n="common.save">保存</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Toast 通知 -->
        <div class="toast-container" id="toastContainer"></div>

        <script src="app.js?v=20260107u"></script>
    </body>
</html>
