<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="theme-color" content="#06060f" />
        <meta name="description" content="使用 Google Gemini AI 生成精美图片 - 梦想写真馆" />
        <title>梦想写真馆 - AI 图片生成器</title>
        <link rel="stylesheet" href="style.css" />
        <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>✨</text></svg>" />
    </head>
    <body>
        <!-- 宇宙背景层 -->
        <div class="cosmic-bg" aria-hidden="true"></div>
        <div class="grid-overlay" aria-hidden="true"></div>

        <div class="container">
            <header>
                <div class="header-controls">
                    <button class="theme-switch-btn" id="themeSwitchBtn" onclick="toggleTheme()" aria-label="Toggle theme">🌙 Dark</button>
                    <button class="lang-switch-btn" id="langSwitchBtn" onclick="switchLanguage()" aria-label="Switch language">EN</button>
                </div>
                <h1>✨ <span data-i18n="site.title">梦想写真馆</span></h1>
                <p class="subtitle" data-i18n="site.subtitle">由 Google Gemini AI 驱动 · 创造精美图像</p>
            </header>

            <main>
                <!-- 步骤 1: 选择模板 -->
                <section class="template-section">
                    <div class="section-header">
                        <h2><span class="step-number">1</span> <span data-i18n="template.title">选择风格模板</span></h2>
                        <p class="section-desc" data-i18n="template.desc">点击选择你喜欢的风格，AI 将按此风格生成图片</p>
                    </div>
                    
                    <!-- 模板分类标签 -->
                    <div class="template-categories" id="templateCategories">
                        <button type="button" class="category-btn active" data-category="all" data-i18n="template.category.all">全部</button>
                        <button type="button" class="category-btn" data-category="portrait" data-i18n="template.category.portrait">人像写真</button>
                        <button type="button" class="category-btn" data-category="creative" data-i18n="template.category.creative">创意艺术</button>
                        <button type="button" class="category-btn" data-category="scene" data-i18n="template.category.scene">场景合成</button>
                    </div>
                    
                    <!-- 模板网格 -->
                    <div class="template-grid" id="templateGrid">
                        <!-- 模板卡片由 JS 动态生成 -->
                    </div>
                    
                    <!-- 已选模板详情 -->
                    <div class="selected-template" id="selectedTemplate" style="display: none;">
                        <div class="selected-template-preview">
                            <img id="selectedTemplateImg" src="" alt="Selected template" />
                        </div>
                        <div class="selected-template-info">
                            <h3 id="selectedTemplateName"></h3>
                            <p id="selectedTemplateDesc"></p>
                            <button type="button" class="btn btn-small btn-secondary" onclick="clearTemplateSelection()">
                                ✕ <span data-i18n="template.change">更换模板</span>
                            </button>
                        </div>
                    </div>
                </section>

                <!-- 步骤 2: 上传照片 -->
                <section class="generate-section">
                    <div class="section-header">
                        <h2><span class="step-number">2</span> <span data-i18n="reference.title">上传你的照片</span></h2>
                        <p class="section-desc" data-i18n="reference.desc">上传清晰的人物照片，AI 将保留你的面部特征</p>
                    </div>
                    
                    <div class="form-group">
                        <div class="reference-upload-area" id="referenceUploadArea">
                            <input
                                type="file"
                                id="referenceImages"
                                multiple
                                accept="image/*"
                                onchange="handleReferenceImages(event)"
                                class="file-input-hidden"
                            />
                            <label
                                for="referenceImages"
                                class="upload-placeholder"
                                id="uploadPlaceholder"
                                role="button"
                                tabindex="0"
                            >
                                <span class="upload-icon">📸</span>
                                <span data-i18n="reference.upload">点击上传参考图片（最多5张）</span>
                                <span class="upload-hint" data-i18n="reference.upload.hint">建议上传不同角度的清晰照片</span>
                            </label>
                            <div class="reference-preview" id="referencePreview"></div>
                        </div>
                    </div>
                </section>

                <!-- 步骤 3: 调整参数 -->
                <section class="settings-section">
                    <div class="section-header">
                        <h2><span class="step-number">3</span> <span data-i18n="settings.title">调整设置</span></h2>
                    </div>

                    <!-- 宽高比选择 - 可视化图标 -->
                    <div class="form-group">
                        <label data-i18n="aspectratio.label">宽高比</label>
                        <div class="aspect-ratio-grid" id="aspectRatioGrid">
                            <button type="button" class="aspect-btn active" data-ratio="1:1" title="1:1 正方形">
                                <div class="aspect-icon" style="width: 32px; height: 32px;"></div>
                                <span>1:1</span>
                            </button>
                            <button type="button" class="aspect-btn" data-ratio="16:9" title="16:9 横屏宽幅">
                                <div class="aspect-icon" style="width: 40px; height: 22px;"></div>
                                <span>16:9</span>
                            </button>
                            <button type="button" class="aspect-btn" data-ratio="9:16" title="9:16 竖屏/手机">
                                <div class="aspect-icon" style="width: 22px; height: 40px;"></div>
                                <span>9:16</span>
                            </button>
                            <button type="button" class="aspect-btn" data-ratio="4:3" title="4:3 标准横屏">
                                <div class="aspect-icon" style="width: 36px; height: 27px;"></div>
                                <span>4:3</span>
                            </button>
                            <button type="button" class="aspect-btn" data-ratio="3:4" title="3:4 标准竖屏">
                                <div class="aspect-icon" style="width: 27px; height: 36px;"></div>
                                <span>3:4</span>
                            </button>
                            <button type="button" class="aspect-btn" data-ratio="3:2" title="3:2 照片横屏">
                                <div class="aspect-icon" style="width: 36px; height: 24px;"></div>
                                <span>3:2</span>
                            </button>
                            <button type="button" class="aspect-btn" data-ratio="2:3" title="2:3 照片竖屏">
                                <div class="aspect-icon" style="width: 24px; height: 36px;"></div>
                                <span>2:3</span>
                            </button>
                            <button type="button" class="aspect-btn" data-ratio="21:9" title="21:9 超宽屏">
                                <div class="aspect-icon" style="width: 44px; height: 19px;"></div>
                                <span>21:9</span>
                            </button>
                        </div>
                    </div>

                    <div class="form-row">
                        <!-- 模型选择 - 简化为高级/快速 -->
                        <div class="form-group">
                            <label data-i18n="model.label">生成质量</label>
                            <div class="model-toggle" id="modelToggle">
                                <button type="button" class="model-btn active" data-model="gemini-3-pro-image-preview">
                                    <span class="model-icon">⭐</span>
                                    <span class="model-name" data-i18n="model.premium">高级</span>
                                    <span class="model-desc" data-i18n="model.premium.desc">4K 高清</span>
                                </button>
                                <button type="button" class="model-btn" data-model="gemini-2.5-flash-image">
                                    <span class="model-icon">⚡</span>
                                    <span class="model-name" data-i18n="model.fast">快速</span>
                                    <span class="model-desc" data-i18n="model.fast.desc">标准画质</span>
                                </button>
                            </div>
                        </div>

                        <!-- 生成数量 - 带预估时间 -->
                        <div class="form-group">
                            <label data-i18n="quantity.label">生成数量</label>
                            <div class="quantity-selector" id="quantitySelector">
                                <button type="button" class="quantity-btn active" data-count="1">
                                    <span class="quantity-num">1</span>
                                    <span class="quantity-time">~30秒</span>
                                </button>
                                <button type="button" class="quantity-btn" data-count="2">
                                    <span class="quantity-num">2</span>
                                    <span class="quantity-time">~60秒</span>
                                </button>
                                <button type="button" class="quantity-btn" data-count="4">
                                    <span class="quantity-num">4</span>
                                    <span class="quantity-time">~2分钟</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 分辨率 - 更直观的展示 -->
                    <div class="form-group" id="resolutionGroup">
                        <label data-i18n="resolution.label">画质</label>
                        <div class="resolution-selector" id="resolutionSelector">
                            <button type="button" class="resolution-btn" data-size="1K">
                                <span class="resolution-label">标准</span>
                                <span class="resolution-size">1K</span>
                            </button>
                            <button type="button" class="resolution-btn" data-size="2K">
                                <span class="resolution-label">高清</span>
                                <span class="resolution-size">2K</span>
                            </button>
                            <button type="button" class="resolution-btn active" data-size="4K">
                                <span class="resolution-label">超清</span>
                                <span class="resolution-size">4K</span>
                            </button>
                        </div>
                        <p class="form-hint resolution-hint" id="resolutionHint" data-i18n="resolution.hint.supported">
                            高级模式支持 1K/2K/4K 分辨率
                        </p>
                    </div>

                    <button
                        class="btn btn-primary btn-generate"
                        id="generateBtn"
                        onclick="generateImage()"
                    >
                        <span class="btn-text">✨ <span data-i18n="generate.button">生成图片</span></span>
                        <span class="btn-loading" style="display: none">
                            <span class="spinner"></span>
                            <span data-i18n="generate.loading">创作中...</span>
                        </span>
                    </button>
                </section>

                <!-- 当前生成结果 -->
                <section
                    class="result-section"
                    id="resultSection"
                    style="display: none"
                >
                    <h2 data-i18n="result.title">🎨 生成结果</h2>
                    <div class="result-images" id="resultImages"></div>
                </section>

                <!-- 历史记录 -->
                <section class="history-section">
                    <div class="history-header">
                        <h2>📚 <span data-i18n="history.title">历史记录</span></h2>
                        <button class="btn btn-danger btn-small" onclick="clearHistory()">
                            🗑️ <span data-i18n="history.clear">清空</span>
                        </button>
                    </div>
                    <div class="history-grid" id="historyGrid">
                        <p class="empty-tip" data-i18n="history.empty">暂无历史记录，开始创作吧！</p>
                    </div>
                </section>
            </main>

            <footer>
                <p data-i18n="footer.text">基于 Google Gemini 和 Cloudflare Workers 构建 💫</p>
            </footer>
        </div>

        <!-- 加载动画遮罩 -->
        <div class="loading-overlay" id="loadingOverlay">
            <!-- 背景脉冲光晕 -->
            <div class="loading-pulse-bg" aria-hidden="true"></div>
            
            <!-- 轨道粒子系统 -->
            <div class="loading-orbits" aria-hidden="true">
                <div class="orbit orbit-1"><span></span><span></span><span></span></div>
                <div class="orbit orbit-2"><span></span><span></span></div>
                <div class="orbit orbit-3"><span></span><span></span><span></span><span></span></div>
            </div>
            
            <!-- 中心画框动画 -->
            <div class="loading-canvas">
                <div class="canvas-frame">
                    <div class="canvas-inner">
                        <div class="canvas-wave"></div>
                        <div class="canvas-wave wave-2"></div>
                        <div class="canvas-wave wave-3"></div>
                    </div>
                    <div class="canvas-corners">
                        <span></span><span></span><span></span><span></span>
                    </div>
                </div>
                <div class="canvas-glow"></div>
            </div>
            
            <!-- 文字内容 -->
            <div class="loading-content">
                <p class="loading-text" data-i18n="loading.title">正在创作你的杰作...</p>
                <div class="loading-dots">
                    <span></span><span></span><span></span>
                </div>
                <p class="loading-hint" data-i18n="loading.hint">通常需要 10-30 秒</p>
            </div>
        </div>

        <!-- 图片预览弹窗 -->
        <div class="modal" id="imageModal" onclick="closeModal()" role="dialog" aria-modal="true">
            <div class="modal-content" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeModal()" aria-label="Close">&times;</span>
                <img id="modalImage" src="" alt="Preview image" />
                <div class="modal-actions">
                    <button class="btn btn-primary" onclick="downloadImage()">
                        📥 <span data-i18n="modal.download">下载图片</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 历史详情弹窗 -->
        <div class="modal" id="historyModal" onclick="closeHistoryModal()" role="dialog" aria-modal="true">
            <div class="modal-content modal-large" onclick="event.stopPropagation()">
                <span class="modal-close" onclick="closeHistoryModal()" aria-label="Close">&times;</span>
                <div class="history-detail" id="historyDetail"></div>
            </div>
        </div>

        <script src="app.js"></script>
    </body>
</html>
